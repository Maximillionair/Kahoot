<%- include('../partials/header') %>

<div class="host-game">
  <h1>Host Game: <%= quiz.title %></h1>
  
  <div class="game-info">
    <h2>Game PIN: <span class="game-pin"><%= game.pin %></span></h2>
    <p>Share this PIN with your players to join the game!</p>
  </div>
  
  <div class="game-details">
    <p>Questions: <%= quiz.questions.length %></p>
    <p>Players: <span id="player-count">0</span></p>
  </div>
  
  <div class="player-list">
    <h3>Players</h3>
    <ul id="players"></ul>
  </div>
  
  <form action="/game/start/<%= game._id %>" method="POST">
    <button type="submit" class="btn primary" id="start-btn" disabled>Start Game</button>
  </form>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const socket = io();
    const gameId = '<%= game._id %>';
    const quiz = JSON.stringify(quiz) ;
    const playerList = document.getElementById('players');
    const playerCount = document.getElementById('player-count');
    const startBtn = document.getElementById('start-btn');
    
    // Connect to socket and create game room
    socket.emit('create-game', { 
      gameId: gameId,
      quiz: quiz
    });
    
    // Handle player joins
    socket.on('player-joined', function(data) {
      const players = data.players || [];
      
      // Update player list
      playerList.innerHTML = '';
      players.forEach(playerName => {
        const li = document.createElement('li');
        li.textContent = playerName;
        playerList.appendChild(li);
      });
      
      // Update player count
      playerCount.textContent = players.length;
      
      // Enable start button if there's at least one player
      startBtn.disabled = players.length === 0;
    });
  });
</script>

<%- include('../partials/footer') %>
